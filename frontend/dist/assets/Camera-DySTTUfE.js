import{r,j as t}from"./vendor-CGXhCyq3.js";import{W as x}from"./WinButton-AkImxujQ.js";import{i as P}from"./reload-BJbcTP1T.js";import{u as G,I as w}from"./game-CTJRJL75.js";import"./i18n-CjG_VPcn.js";const F="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3cpath%20d='M20%202h-2v4H6v2H4v8h2v2h2v4h8v-2h4v-2h-4v-2h4v-2h-4v-2H8v4H6V8h12V6h2V2zm-6%2018h-4v-6h4v6z'%20fill='currentColor'/%3e%3c/svg%3e",U="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3cpath%20d='M9%203H7v2H2v16h20V5h-5V3H9zm8%204h3v12H4V7h5V5h6v2h2zm-7%202h4v2h-4V9zm4%206h-4v2h4v-2h2v-4h-2v4zm-6-4h2v4H8v-4z'%20fill='currentColor'/%3e%3c/svg%3e",L="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3cpath%20d='M14%202h8v20H12V2h2zm6%202h-6v16h6V4zM10%2020H4v-6h6v-2H6v-2H4V8h2V6h2V4h2V2H8v2H6v2H4v2H2v2h2v2H2v10h8v-2zm8-4h-2v2h2v-2z'%20fill='currentColor'/%3e%3c/svg%3e",h=160,H=144,O={blue:[[18,11,25],[60,72,110],[108,132,168],[165,186,206]],green:[[15,38,15],[48,98,48],[139,172,15],[155,188,15]],warm:[[20,16,12],[120,98,72],[170,145,110],[205,185,145]]},Q=()=>{const i=r.useRef(null),d=r.useRef(null),f=r.useRef(null),{t:a}=G(),[c,_]=r.useState(!1),[j,z]=r.useState("blue"),[v,E]=r.useState("user"),[,I]=r.useState(null),[N,l]=r.useState(a("camera_ready")),g=()=>{f.current&&(f.current.getTracks().forEach(e=>e.stop()),f.current=null),i.current&&(i.current.srcObject=null)},V=r.useCallback(async()=>{g(),l(a("camera_init"));try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:v,width:{ideal:640},height:{ideal:480}}});if(f.current=e,i.current){i.current.srcObject=e;try{await i.current.play(),_(!0),l(a("camera_active"))}catch(s){s.name!=="AbortError"&&console.error("Play error:",s)}}}catch(e){console.error(e),l(a("camera_error")),_(!1)}},[v,a]),R=r.useCallback(()=>{g(),_(!1),l(a("camera_stopped"))},[a]),k=()=>{E(e=>e==="user"?"environment":"user")};r.useEffect(()=>(c&&V(),()=>{g()}),[v]),r.useEffect(()=>(V(),()=>g()),[]),r.useEffect(()=>{if(!c)return;let e;const s=d.current,n=s?.getContext("2d",{willReadFrequently:!0}),u=i.current,T=O[j],b=()=>{if(!(!s||!n||!u)){if(u.readyState===u.HAVE_ENOUGH_DATA){s.width=h,s.height=H,n.save(),v==="user"?(n.scale(-1,1),n.drawImage(u,-h,0,h,H)):n.drawImage(u,0,0,h,H),n.restore();const y=n.getImageData(0,0,h,H),m=y.data;for(let o=0;o<m.length;o+=4){const C=.299*m[o]+.587*m[o+1]+.114*m[o+2];let p=0;C>180?p=3:C>120?p=2:C>70&&(p=1);const[M,S,B]=T[p];m[o]=M,m[o+1]=S,m[o+2]=B}n.putImageData(y,0,0)}e=requestAnimationFrame(b)}};return b(),()=>cancelAnimationFrame(e)},[c,j,v]);const A=()=>{z(e=>e==="blue"?"green":e==="green"?"warm":"blue"),l(`${a("camera_palette")}: ${j.toUpperCase()}`)},D=()=>{if(!d.current)return;const e=d.current.toDataURL("image/png");I(e);const s=document.createElement("a");s.download=`MewDows-Cam-${Date.now()}.png`,s.href=e,s.click(),l(a("camera_saved")),setTimeout(()=>l(a("camera_ready")),2e3)};return t.jsxs("div",{className:"camera-container",children:[t.jsxs("div",{className:"camera-display",children:[t.jsx("video",{ref:i,autoPlay:!0,playsInline:!0,muted:!0,className:"camera-video--hidden"}),t.jsx("canvas",{ref:d,className:"camera-canvas",style:{imageRendering:"pixelated"}}),!c&&t.jsx("div",{className:"camera-overlay-text",children:a("camera_off")})]}),t.jsxs("div",{className:"camera-controls",children:[t.jsxs("div",{className:"camera-controls-group",children:[t.jsx(x,{onClick:c?R:V,title:a(c?"camera_turn_off":"camera_turn_on"),children:t.jsx(w,{icon:F,size:16,className:c?"camera-icon-on":"camera-icon-off"})}),t.jsx(x,{onClick:k,disabled:!c,title:a("camera_flip"),children:t.jsx(w,{icon:P,size:16})}),t.jsx(x,{onClick:A,title:a("camera_change_palette"),children:t.jsx(w,{icon:L,size:16})})]}),t.jsxs(x,{onClick:D,disabled:!c,className:"camera-btn-snap",children:[t.jsx(w,{icon:U,size:16,className:"camera-icon--snap"})," ",a("camera_snap")]})]}),t.jsx("div",{className:"camera-status-bar",children:N})]})};export{Q as CameraApp};
