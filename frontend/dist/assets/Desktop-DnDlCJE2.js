import{r as s,j as e,R as q}from"./vendor-CGXhCyq3.js";import{u as F,L as X,a as ee,f as te,i as ne,A as Y}from"./index-D7J6vo6v.js";import{u as L,c as $,I as R,i as se,d as oe,e as ie}from"./game-mcjZzpRD.js";import{W as O}from"./WinButton-BCLu9xHY.js";import{C as U}from"./close-BryC9SWZ.js";import{M as re}from"./minus-1uO7_Sla.js";import{ShutdownScreen as ae}from"./ShutdownScreen-CP44Xdna.js";import{i as ce}from"./file-alt-2Rtj3xTs.js";import"./i18n-CjG_VPcn.js";const le=()=>{const{t}=L(),[o,u]=s.useState(new Date);return s.useEffect(()=>{const m=setInterval(()=>u(new Date),1e3);return()=>clearInterval(m)},[]),e.jsx("div",{className:"clock","aria-label":t("system_clock"),role:"timer",children:o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})},de=()=>{const{volume:t,setVolume:o}=$(),{t:u}=L(),[m,d]=s.useState(!1),c=s.useRef(null),v=s.useRef(null),g=()=>d(!m);return s.useEffect(()=>{const f=p=>{c.current&&!c.current.contains(p.target)&&v.current&&!v.current.contains(p.target)&&d(!1)};return m&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[m]),e.jsxs("div",{className:"volume-control",children:[m&&e.jsx("div",{className:"volume-control__popup",ref:c,children:e.jsx("div",{className:"volume-control__slider-wrapper",children:e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:t,onChange:f=>o(parseFloat(f.target.value)),className:"volume-control__slider",orient:"vertical","aria-label":u("volume_control")})})}),e.jsx("button",{ref:v,onClick:g,className:"volume-control__btn",title:u("volume"),"aria-label":u("volume"),"aria-haspopup":"true","aria-expanded":m,children:e.jsx(R,{icon:t>0?se:oe,size:18,className:"volume-control__icon"})})]})},ue="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAAyCAYAAAD4FkP1AAAAAXNSR0IArs4c6QAAAMdJREFUaIHt2rENgkAYhmExdlg7gXEGezegtbNxBAob1qC2snEgY4x2LkCtA/AX5ADx+/I+5YUcvPmTyxVk+6L6zEzNp/6AMRGnyjpuES0eVu/kDc/LXafnimOT/I7IpXy21qwnR5wq4lQRp4o4VeENpest499ZT444VdZx4YGSb9bJGza3e5/vGZT15IhTZR0XHii/cK3z0d9hPTniVFnHTXagnLavQferHu0168kRp4o4VcSpIk5Vxn8ooohTRZwq4lQRp+oLpYMS+7GH5SUAAAAASUVORK5CYII=",me="data:image/webp;base64,UklGRnIBAABXRUJQVlA4IGYBAADQCgCdASo3ADIAPmUqkEWkIqGb+1QAQAZEswBlGeFlV+Nwn59qdvtjedz/rv6k6zH6Ev7AdcJkSOO8KsfElJUhbP/yQdWz/e7HXClk8FB3Uqiu4dPO6zrd2gLymJiyAAD++faXh/4qfB7Z69thAb+V/ZZbADIBAAcmRT/SK4zOp+F8vH+WqJtBLfQx2bbAVLY+O2YSoEryUdaYAEyY0L6nHd7+Ga73IDS1Ba186QUZyiyEg/LvoAcZDbQsJZnS+3/Vssb77D0ompW4Sctx8n5PcVsVwyw3swZfmOyoDoWO+AWC2xNVNQpofllN2fpgYXlj+Xo3lhyx7uE/Z5yh9GnLXaJNL+UMxhe9CyA+gpoAnzT2r1jzGOCwiG+cL3+FnRRgnSczOZago3bJBwjfAiccHeYNI7bH+WdoxkpqGmClonsGkFhgmkAcFa1Xn0g60gGyJhcMYR4Eg2mxfoGfW+piQAAAAAAA",we="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3cpath%20d='M5%203h16v4h-2V5H5v14h14v-2h2v4H3V3h2zm16%208h-2V9h-2V7h-2v2h2v2H7v2h10v2h-2v2h2v-2h2v-2h2v-2z'%20fill='currentColor'/%3e%3c/svg%3e",he="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3cpath%20d='M8%205v2h2V5H8zm4%204V7h-2v2h2zm2%202V9h-2v2h2zm0%202h2v-2h-2v2zm-2%202v-2h2v2h-2zm0%200h-2v2h2v-2zm-4%204v-2h2v2H8z'%20fill='currentColor'/%3e%3c/svg%3e",fe="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3cpath%20d='M4%204h8v2h10v14H2V4h2zm16%204H10V6H4v12h16V8z'%20fill='currentColor'/%3e%3c/svg%3e",V=t=>{const o=s.useRef(null),u=s.useRef(null);return s.useEffect(()=>{if(t){u.current=document.activeElement;const d=o.current?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');d&&d.length>0&&requestAnimationFrame(()=>{d[0].focus()})}return()=>{t&&u.current&&u.current.isConnected&&u.current.focus()}},[t]),{containerRef:o,handleKeyDown:d=>{if(!(!t||!o.current)&&d.key==="Tab"){const c=o.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!c.length)return;const v=c[0],g=c[c.length-1];d.shiftKey?document.activeElement===v&&(d.preventDefault(),g.focus()):document.activeElement===g&&(d.preventDefault(),v.focus())}}}},pe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAAAXNSR0IArs4c6QAAAUJJREFUeJzt3LFJBFEUQFFXzIw0swQjwQ7EQLADCxDjrWQLsIDNDAVFsAZzI2PBErSA+cGwV9SVc8LHwHwuDz4bzC4O948+d9jY7m8fYNsJGAkYCRjtjYZXq/ufP8kWWC8vJzMbGAkYCRgJGA0vkZHV9cGs55a3H+U83+ri7GUyO355n8zenl4ns7vTm1nvsIGRgJGAkYDR7EvkL10Ocz08n0xnowdPzzd+hw2MBIwEjASMhpfI3F8d/9nj89tkth48ZwMjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwGj4Rfro6+1GbOBkYCRgJGA0cJfwTc2MBIwEjASMPoCIOsbRX7fweMAAAAASUVORK5CYII=",ve="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3cpath%20d='M20%203H2v14h8v2H8v2h8v-2h-2v-2h8V3h-2zm-6%2012H4V5h16v10h-6z'%20fill='currentColor'/%3e%3c/svg%3e",xe=({onCancel:t})=>{const{t:o}=L(),{shutDownSystem:u,rebootSystem:m,returnToGame:d}=F(),[c,v]=s.useState("shutdown"),{containerRef:g,handleKeyDown:f}=V(!0);s.useEffect(()=>{const w=y=>{y.key==="Escape"&&t()};return window.addEventListener("keydown",w),()=>window.removeEventListener("keydown",w)},[t]);const p=()=>{switch(c){case"shutdown":u();break;case"restart":m();break;case"return_game":d();break}};return e.jsx("div",{className:"shutdown-dialog-overlay",role:"dialog","aria-modal":"true","aria-labelledby":"shutdown-title",children:e.jsxs("div",{className:"shutdown-dialog",ref:g,onKeyDown:f,children:[e.jsxs("div",{className:"shutdown-dialog__header",children:[e.jsx("span",{id:"shutdown-title",className:"shutdown-dialog__title",children:o("shutdown_title")}),e.jsx("button",{className:"shutdown-dialog__close",onClick:t,"aria-label":o("close"),children:"Ã—"})]}),e.jsxs("div",{className:"shutdown-dialog__content",children:[e.jsx("div",{className:"shutdown-dialog__icon",children:e.jsx(R,{icon:ve,size:32})}),e.jsxs("div",{className:"shutdown-dialog__options",children:[e.jsx("h3",{className:"shutdown-dialog__label",children:o("shutdown_question")}),e.jsxs("div",{className:"shutdown-dialog__radio-group",role:"radiogroup",children:[e.jsxs("label",{className:"shutdown-dialog__radio-option",children:[e.jsx("input",{type:"radio",name:"shutdown-option",value:"shutdown",checked:c==="shutdown",onChange:()=>v("shutdown"),className:"shutdown-dialog__radio-input"}),o("shutdown_computer")]}),e.jsxs("label",{className:"shutdown-dialog__radio-option",children:[e.jsx("input",{type:"radio",name:"shutdown-option",value:"restart",checked:c==="restart",onChange:()=>v("restart"),className:"shutdown-dialog__radio-input"}),o("restart_computer")]}),e.jsxs("label",{className:"shutdown-dialog__radio-option",children:[e.jsx("input",{type:"radio",name:"shutdown-option",value:"return_game",checked:c==="return_game",onChange:()=>v("return_game"),className:"shutdown-dialog__radio-input"}),o("return_to_game")]})]})]})]}),e.jsxs("div",{className:"shutdown-dialog__buttons",children:[e.jsx("button",{className:"shutdown-dialog__button",onClick:p,children:o("ok")}),e.jsx("button",{className:"shutdown-dialog__button",onClick:t,children:o("cancel")})]})]})})},_e=({onClose:t,apps:o})=>{const{t:u}=L(),{openWindow:m}=F(),d=s.useRef(null),[c,v]=s.useState(null),[g,f]=s.useState(!1),p=s.useRef(null),{containerRef:w,handleKeyDown:y}=V(!g),r=n=>{if(y(n),n.key==="ArrowDown"||n.key==="ArrowUp"){n.preventDefault();const i=Array.from(d.current?.querySelectorAll('[role="menuitem"]')||[]);if(i.length===0)return;const a=i.indexOf(document.activeElement);let h=a;n.key==="ArrowDown"?h=(a+1)%i.length:h=(a-1+i.length)%i.length,i[h]?.focus()}n.key==="Escape"&&t()};s.useEffect(()=>{const n=i=>{if(!g&&w.current&&!w.current.contains(i.target)){if(document.getElementById("start-button")?.contains(i.target))return;t()}};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[t,w,g]);const l=n=>{m(n),t()},_=o.find(n=>n.id==="projects");return g?e.jsx(xe,{onCancel:()=>f(!1)}):e.jsxs("div",{ref:w,className:"start-menu",onKeyDown:r,onContextMenu:n=>{n.preventDefault(),n.stopPropagation()},role:"menu","aria-label":u("start_menu"),children:[e.jsx("aside",{className:"start-menu__sidebar","aria-hidden":"true",children:e.jsxs("span",{className:"start-menu__sidebar-text",children:[e.jsx("span",{className:"start-menu__brand-name",children:"Windows"}),"95"]})}),e.jsxs("section",{className:"start-menu__content",children:[e.jsxs("div",{className:"start-menu__item-wrapper",onMouseEnter:()=>v("programs"),onMouseLeave:()=>v(null),role:"none",children:[e.jsxs(O,{ref:p,variant:"menu",role:"menuitem","aria-haspopup":"true","aria-expanded":c==="programs",className:"start-menu__item",onClick:()=>v(c==="programs"?null:"programs"),onKeyDown:n=>{(n.key==="ArrowRight"||n.key==="Enter"||n.key===" ")&&(v("programs"),n.preventDefault(),setTimeout(()=>{document.getElementById("submenu-programs-0")?.focus()},0))},children:[e.jsx(R,{icon:pe,size:24,className:"start-menu__item-icon"}),e.jsx("span",{className:"start-menu__label",children:u("programs")}),e.jsx(R,{icon:he,className:"start-menu__chevron"})]}),c==="programs"&&e.jsx("div",{className:"start-menu__submenu",role:"menu",children:o.filter(n=>n.visibility?.programs).map((n,i)=>e.jsxs(O,{id:`submenu-programs-${i}`,variant:"menu",onClick:()=>l(n),role:"menuitem",className:"start-menu__item",onKeyDown:a=>{a.key==="ArrowLeft"&&(v(null),a.preventDefault(),a.stopPropagation(),p.current?.focus())},children:[e.jsx(R,{icon:n.icon,size:24,className:"start-menu__item-icon"}),e.jsx("span",{className:"start-menu__label",children:n.title})]},n.id))})]}),e.jsxs(O,{variant:"menu",onClick:()=>_&&l(_),role:"menuitem",className:"start-menu__item",children:[e.jsx(R,{icon:_?.icon||fe,size:24,className:"start-menu__item-icon"}),e.jsx("span",{className:"start-menu__label",children:u("projects")})]}),e.jsx("div",{className:"start-menu__divider"}),e.jsxs(O,{variant:"menu",onClick:()=>f(!0),role:"menuitem",className:"start-menu__item",children:[e.jsx(R,{icon:we,className:"start-menu__icon"}),e.jsx("span",{className:"start-menu__label",children:u("shutdown")})]})]})]})},ge=({availableApps:t})=>{const{t:o,language:u,setLanguage:m}=L(),{windows:d,activeWindowId:c,focusWindow:v,minimizeWindow:g}=F(),[f,p]=s.useState(!1),[,w]=s.useState(new Date),[y,r]=s.useState(null),l=s.useRef(null),_=s.useRef(null),n=16,i=6,a=1600,h=()=>{m(u==="en"?"pt-BR":u==="pt-BR"?"es":"en")},b=o(u==="en"?"btn_to_pt":u==="pt-BR"?"btn_to_es":"btn_to_en");s.useEffect(()=>{const x=E=>{(E.key==="Meta"||E.ctrlKey&&E.key==="Escape")&&(E.preventDefault(),window.dispatchEvent(new CustomEvent("toggle-start-menu")))};window.addEventListener("keydown",x);const A=setInterval(()=>w(new Date),1e3);return()=>{window.removeEventListener("keydown",x),clearInterval(A)}},[]),s.useEffect(()=>{const x=A=>{_.current&&!_.current.contains(A.target)&&p(!1)};return f&&document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[f]),s.useEffect(()=>()=>{l.current&&clearTimeout(l.current)},[]);const j=x=>{const A=d.find(E=>E.id===x);p(!1),c===x&&!A?.isMinimized?g(x):v(x)},S=x=>x.length>n?x.substring(0,n)+"...":x,D=x=>{l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{r(x)},a)},C=()=>{l.current&&(clearTimeout(l.current),l.current=null),r(null)},N=d.slice(0,i);return e.jsxs("footer",{className:"taskbar",role:"contentinfo","aria-label":o("taskbar_label")||"Taskbar",onContextMenu:x=>{x.preventDefault(),x.stopPropagation()},children:[e.jsxs("div",{className:"taskbar__start-menu-wrapper",ref:_,children:[f&&e.jsx("div",{className:"taskbar__start-popup",children:e.jsx(_e,{onClose:()=>p(!1),apps:t})}),e.jsxs(O,{id:"start-button",active:f,onClick:()=>p(!f),className:"taskbar__start-btn",variant:"taskbar","aria-haspopup":"true","aria-expanded":f,"aria-label":o("start_menu"),children:[e.jsxs("picture",{children:[e.jsx("source",{srcSet:me,type:"image/webp"}),e.jsx("img",{src:ue,alt:o("alt_taskbar_start_icon"),className:"taskbar__icon",onError:x=>{x.currentTarget.style.display="none"},"aria-hidden":"true",width:16,height:16})]}),e.jsx("span",{className:"taskbar__start-text",children:o("start")})]})]}),e.jsx("div",{className:"taskbar__divider"}),e.jsx("nav",{className:"taskbar__windows","aria-label":o("running_apps")||"Running applications",children:N.map(x=>{const A=x.title.length>n,E=c===x.id&&!x.isMinimized;return e.jsxs("div",{className:"taskbar__window-item",onMouseEnter:()=>D(x.id),onMouseLeave:C,onClick:C,children:[y===x.id&&A&&e.jsx("div",{className:"taskbar__tooltip",role:"tooltip",children:x.title}),e.jsxs(O,{active:E,onClick:()=>j(x.id),className:"taskbar__window-btn",variant:"taskbar","aria-label":`Switch to ${x.title}`,"aria-pressed":E,children:[e.jsx(R,{icon:x.icon,size:16,className:"taskbar__window-icon",alt:o("alt_taskbar_app_icon")}),e.jsx("span",{className:"taskbar__window-text",children:S(x.title)})]})]},x.id)})}),e.jsx("div",{className:"taskbar__divider"}),e.jsxs("div",{className:"taskbar__tray",children:[e.jsx("button",{onClick:h,className:"taskbar__language-btn",title:b,"aria-label":b,children:u==="en"?"ðŸ‡ºðŸ‡¸":u==="pt-BR"?"ðŸ‡§ðŸ‡·":"ðŸ‡ªðŸ‡¸"}),e.jsx(de,{}),e.jsx(le,{})]})]})},G=(t,o,u=0,m)=>{const[d,c]=s.useState(!1),[v,g]=s.useState(t),f=s.useRef({offset:{x:0,y:0},position:t,boundary:m,resetKey:u});s.useEffect(()=>{f.current.boundary=m},[m]),s.useEffect(()=>{g(t),f.current.position=t},[u]);const p=s.useCallback((r,l)=>{const _=f.current.position;f.current.offset={x:r-_.x,y:l-_.y},c(!0)},[]),w=s.useCallback(r=>{r.button===0&&(r.stopPropagation(),p(r.clientX,r.clientY))},[p]),y=s.useCallback(r=>{r.stopPropagation();const l=r.touches[0];p(l.clientX,l.clientY)},[p]);return s.useEffect(()=>{if(!d)return;const r=(i,a)=>{const{offset:h,boundary:b}=f.current;let j=i-h.x,S=a-h.y;if(b){const C=window.innerWidth-b.width,N=window.innerHeight-b.height-(b.bottomOffset??0),x=20;j<x&&(j=0),Math.abs(j-C)<x&&(j=C),S<x&&(S=0),Math.abs(S-N)<x&&(S=N),j=Math.max(0,Math.min(j,C)),S=Math.max(0,Math.min(S,N))}const D={x:j,y:S};g(D),f.current.position=D},l=i=>{i.preventDefault(),r(i.clientX,i.clientY)},_=i=>{i.cancelable&&i.preventDefault(),r(i.touches[0].clientX,i.touches[0].clientY)},n=()=>{c(!1),o(f.current.position)};return window.addEventListener("mousemove",l),window.addEventListener("mouseup",n),window.addEventListener("touchmove",_,{passive:!1}),window.addEventListener("touchend",n),()=>{window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",n),window.removeEventListener("touchmove",_),window.removeEventListener("touchend",n)}},[d,o]),{position:v,handleMouseDown:w,handleTouchStart:y,isDragging:d}},be={width:300,height:200},ye=(t,o,u,m,d,c,v=be)=>{const[g,f]=s.useState(m),[p,w]=s.useState(!1),y=s.useRef(m),{width:r,height:l}=m;s.useEffect(()=>{p||f(n=>{if(n.width===r&&n.height===l)return n;const i={width:r,height:l};return y.current=i,i})},[r,l,p]);const _=s.useCallback(n=>{t&&(n.stopPropagation(),n.cancelable&&n.preventDefault(),w(!0))},[t]);return s.useEffect(()=>{if(!p||o)return;const n=(b,j)=>{const D=window.innerHeight-c,C=Math.min(j,D),N=b-u.x,x=C-u.y,A={width:Math.max(v.width,N),height:Math.max(v.height,x)};f(A),y.current=A},i=b=>{b.preventDefault(),n(b.clientX,b.clientY)},a=b=>{b.cancelable&&b.preventDefault(),n(b.touches[0].clientX,b.touches[0].clientY)},h=()=>{w(!1),d(y.current.width,y.current.height)};return window.addEventListener("mousemove",i),window.addEventListener("mouseup",h),window.addEventListener("touchmove",a,{passive:!1}),window.addEventListener("touchend",h),()=>{window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",h),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",h)}},[p,o,u,c,d,v]),{size:g,isResizing:p,startResize:_}},Ae=65,ke=({data:t})=>{const{focusWindow:o,updateWindowPosition:u,activeWindowId:m,closeWindow:d}=F(),{t:c}=L(),v=s.useRef(null),g=m===t.id,f=`${t.id}-${t.isMaximized}-${t.size.width}-${t.size.height}`,{handleMouseDown:p,isDragging:w}=G(t.position,l=>u(t.id,l.x,l.y),f,{width:t.size.width,height:t.size.height,bottomOffset:Ae}),y=()=>o(t.id),r={zIndex:t.zIndex,width:t.size.width,height:t.size.height,transform:`translate3d(${t.position.x}px, ${t.position.y}px, 0)`,position:"absolute",top:0,left:0,willChange:w?"transform":"auto"};return e.jsxs("div",{ref:v,style:r,onMouseDown:l=>{y(),p(l)},className:`window--assistant ${g?"window--active":""}`,role:"dialog","aria-modal":"false","aria-label":t.title,tabIndex:-1,children:[e.jsx("button",{className:"window__close-btn assistant-close-btn",onClick:l=>{l.stopPropagation(),d(t.id)},"aria-label":c("close_assistant"),children:e.jsx(R,{icon:U,size:14,style:{filter:"invert(1)"}})}),e.jsx(s.Suspense,{fallback:e.jsx(X,{}),children:t.component})]})},Ee="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3cpath%20d='M5%203h12v4h4v14H7v-4H3V3h2zm10%204V5H5v10h2V7h8zM9%2017v2h10V9H9v8z'%20fill='currentColor'/%3e%3c/svg%3e",K=65,je=({data:t})=>{const{t:o}=L(),{closeWindow:u,minimizeWindow:m,maximizeWindow:d,focusWindow:c,updateWindowPosition:v,updateWindowSize:g,activeWindowId:f}=F(),p=f===t.id,[w,y]=q.useState(null);s.useEffect(()=>{const k=()=>y(null);return w&&window.addEventListener("click",k),()=>window.removeEventListener("click",k)},[w]);const{containerRef:r,handleKeyDown:l}=V(p),_=t.id.startsWith("assistant"),n=`${t.id}-${t.isMaximized}-${t.size.width}-${t.size.height}`,{position:i,handleMouseDown:a,handleTouchStart:h,isDragging:b}=G(t.position,k=>v(t.id,k.x,k.y),n,{width:t.size.width,height:t.size.height,bottomOffset:K}),{size:j,isResizing:S,startResize:D}=ye(p,t.isMaximized,i,t.size,(k,z)=>g(t.id,k,z),K,{width:300,height:300});s.useEffect(()=>{p&&r.current&&r.current.focus({preventScroll:!0})},[p,r]);const C=k=>{p&&l(k)};if(t.isMinimized)return null;const N=()=>c(t.id),x=t.isMaximized?"100%":j.width,A=t.isMaximized?`calc(100vh - ${K}px)`:j.height,E={zIndex:t.zIndex,width:x,height:A,transform:t.isMaximized?"none":`translate3d(${i.x}px, ${i.y}px, 0)`,position:t.isMaximized?"fixed":"absolute",top:0,left:0,willChange:b||S?"transform, width, height":"auto"};if(_)return e.jsx(ke,{data:t});const I=!["messenger","welcome","calculator","google"].some(k=>t.id.startsWith(k)),T=["file","edit","view","help"];return e.jsxs("div",{ref:r,style:E,onMouseDownCapture:N,onTouchStartCapture:N,onKeyDown:C,onContextMenu:k=>{k.preventDefault(),k.stopPropagation()},className:`window ${p?"window--active":"window--inactive"}`,role:"dialog","aria-labelledby":`window-title-${t.id}`,"aria-modal":p?"true":"false",tabIndex:-1,children:[e.jsxs("div",{className:`window__title-bar ${p?"window__title-bar--active":"window__title-bar--inactive"}`,onMouseDown:k=>!t.isMaximized&&a(k),onTouchStart:k=>!t.isMaximized&&h(k),onDoubleClick:()=>d(t.id),children:[e.jsxs("div",{className:"window__title-area",id:`window-title-${t.id}`,children:[e.jsx(R,{icon:t.icon,size:20}),e.jsx("span",{className:"window__title-text",children:t.title})]}),e.jsxs("div",{className:"window__actions",children:[e.jsx(O,{"aria-label":o("minimize"),onClick:()=>m(t.id),children:e.jsx("img",{src:re,className:"window__action-icon",alt:o("window_btn_minimize_alt")})}),e.jsx(O,{"aria-label":t.isMaximized?o("restore"):o("maximize"),onClick:()=>d(t.id),children:t.isMaximized?e.jsx("img",{src:Ee,className:"window__action-icon",alt:o("window_btn_restore_alt")}):e.jsx("img",{src:ie,className:"window__action-icon",alt:o("window_btn_maximize_alt")})}),e.jsx(O,{"aria-label":o("close"),onClick:()=>u(t.id),children:e.jsx("img",{src:U,className:"window__action-icon",alt:o("window_btn_close_alt")})})]})]}),I&&e.jsx("div",{className:"window__menu",role:"menubar",children:T.map(k=>e.jsxs("div",{style:{position:"relative"},role:"none",children:[e.jsx("button",{className:`window__menu-item not-allowed ${w===k?"window__menu-item--active":""}`,role:"menuitem","aria-haspopup":"true","aria-expanded":w===k,onClick:z=>{z.stopPropagation(),y(w===k?null:k)},onMouseEnter:()=>{w&&y(k)},onKeyDown:z=>{z.key==="ArrowDown"&&w===k&&(document.getElementById(`menu-${t.id}-${k}-0`)?.focus(),z.preventDefault()),z.key==="ArrowDown"&&!w&&(y(k),z.preventDefault())},children:o(k)}),w===k&&e.jsx("div",{className:"window__menu-dropdown",role:"menu",onMouseLeave:()=>y(null)})]},k))}),e.jsxs("div",{className:"window__content",children:[e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"window__loading",children:e.jsx(X,{})}),children:t.component}),!p&&e.jsx("div",{className:"window__overlay"})]}),!t.isMaximized&&e.jsx("div",{className:"window__resize-handle",onMouseDown:D,onTouchStart:D,"aria-hidden":"true",title:o("window_resize"),children:e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 12 12",className:"window__resize-icon",children:[e.jsx("path",{d:"M8 11H11V8",stroke:"gray",fill:"none"}),e.jsx("path",{d:"M4 11H7V11",stroke:"gray",fill:"none"}),e.jsx("path",{d:"M11 7V4",stroke:"gray",fill:"none"})]})})]})},J=s.forwardRef(({app:t,initialPosition:o,onDragEnd:u,onSelect:m,isSelected:d,resetKey:c,tabIndex:v=0},g)=>{const{t:f}=L(),p=s.useMemo(()=>({width:100,height:128,bottomOffset:50}),[]),{position:w,handleMouseDown:y,handleTouchStart:r,isDragging:l}=G(o,n=>u(t.id,n.x,n.y),c,p),_=n=>{n.stopPropagation();const i=n.ctrlKey||n.metaKey||n.shiftKey;m(t.id,i)};return e.jsxs("button",{ref:g,type:"button",className:`desktop-icon ${d?"desktop-icon--selected":""} ${l?"desktop-icon--dragging":""}`,style:{transform:`translate3d(${w.x}px, ${w.y}px, 0)`},onMouseDown:n=>{_(n),y(n)},onClick:_,onKeyDown:n=>{if(n.key==="Enter"){n.preventDefault(),n.stopPropagation(),m(t.id,!1);const i=new MouseEvent("dblclick",{bubbles:!0,cancelable:!0,view:window});n.currentTarget.dispatchEvent(i)}},onTouchStart:r,onContextMenu:n=>{n.preventDefault(),n.stopPropagation()},"aria-label":t.title,"aria-pressed":d,tabIndex:v,children:[e.jsx("div",{className:"desktop-icon__img-wrapper",children:e.jsx(R,{icon:t.icon,size:64,className:"desktop-icon__img",alt:f("alt_desktop_app_icon")})}),e.jsx("div",{className:"desktop-icon__label",children:e.jsx("span",{className:"desktop-icon__text",children:t.title})})]})});J.displayName="DesktopIcon";const Se=({onReboot:t})=>{const o=s.useRef(null),{t:u}=L(),{playSound:m}=$();return s.useEffect(()=>{m("error"),o.current?.focus();const d=c=>{c?.preventDefault(),t()};return window.addEventListener("keydown",d),window.addEventListener("click",d),window.addEventListener("touchstart",d),window.addEventListener("pointerdown",d),()=>{window.removeEventListener("keydown",d),window.removeEventListener("click",d),window.removeEventListener("touchstart",d),window.removeEventListener("pointerdown",d)}},[t,m]),e.jsx("div",{ref:o,tabIndex:-1,className:"blue-screen",children:e.jsxs("div",{className:"blue-screen__content",children:[e.jsx("p",{className:"blue-screen__title",children:u("blue_screen_windows")}),e.jsx("p",{className:"blue-screen__message",children:u("blue_screen_fatal_exception")}),e.jsxs("ul",{className:"blue-screen__list",children:[e.jsx("li",{children:u("blue_screen_terminate")}),e.jsx("li",{children:u("blue_screen_ctrl_alt_del")})]}),e.jsx("p",{className:"blue-screen__prompt",children:u("blue_screen_press_any_key")})]})})},M={W:100,H:128,OFFSET_X:10,OFFSET_Y:10},Ie=50,Me=t=>{const{getItemsInFolder:o}=ee(),[u,m]=s.useState(0),[d,c]=s.useState(()=>{try{const r=localStorage.getItem("OS_ICON_POSITIONS");return r?JSON.parse(r):{}}catch{return{}}});s.useEffect(()=>{localStorage.setItem("OS_ICON_POSITIONS",JSON.stringify(d))},[d]);const v=s.useMemo(()=>{const l=o("desktop").filter(n=>n.id!=="recycle_bin").map(n=>{let i=ce;if(n.type==="folder")i=te;else if(n.appId){const a=t.find(h=>h.id===n.appId);a&&(i=a.icon)}else i=ne;return{id:`fs:${n.id}`,title:n.name,icon:i,appId:n.appId||"notepad",fsId:n.id,type:n.type,isSystemApp:!1,content:n.content}});return[...t.filter(n=>n.visibility?.desktop).map(n=>({id:`app:${n.id}`,title:n.title,icon:n.icon,appId:n.id,type:"app",isSystemApp:!0})),...l].sort((n,i)=>n.title.localeCompare(i.title))},[o,t]),g=s.useMemo(()=>{if(typeof window>"u")return{maxRows:6,maxCols:10};const r=window.innerHeight,l=window.innerWidth,_=r-Ie-M.OFFSET_Y,n=l-M.OFFSET_X,i=Math.max(1,Math.floor(_/M.H)),a=Math.max(1,Math.floor(n/M.W));return{maxRows:i,maxCols:a}},[u]),f=s.useCallback((r,l,_,n)=>Object.entries(_).some(([i,a])=>i===n?!1:a.col===r&&a.row===l),[]),p=s.useMemo(()=>{const r={...d},{maxRows:l,maxCols:_}=g,n=_<=4,i=()=>{let a=0,h=0,b=0;const j=l*_+500;if(n)for(;f(a,h,r)&&b<j;)a++,a>=_&&(a=0,h++),b++;else for(;f(a,h,r)&&b<j;)h++,h>=l&&(h=0,a++),b++;return{col:a,row:h}};return v.forEach(a=>{const h=r[a.id];if(!(h&&(n?!0:h.row<l)&&h.col<_)){const j=i();r[a.id]=j}}),r},[v,d,f,g]),w=s.useCallback((r,l,_)=>{const{maxRows:n,maxCols:i}=g,a=Math.round((l-M.OFFSET_X)/M.W),h=Math.round((_-M.OFFSET_Y)/M.H);m(b=>b+1),!(h<0||h>=n||a<0||a>=i)&&(f(a,h,p,r)||c(b=>({...b,[r]:{col:a,row:h}})))},[p,f,g]),y=s.useCallback(()=>{const{maxRows:r}=g,l={};let _=0,n=0;[...v].sort((a,h)=>a.title.localeCompare(h.title)).forEach(a=>{l[a.id]={col:_,row:n},n++,n>=r&&(n=0,_++)}),c(l),m(a=>a+1)},[v,g]);return s.useEffect(()=>{const r=()=>m(l=>l+1);return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),{displayItems:v,computedPositions:p,handleDragEnd:w,setIconPositions:c,setDragVersion:m,dragVersion:u,arrangeIcons:y}},Ne=(t,o,u)=>{const[m,d]=s.useState([]),[c,v]=s.useState(null),g=s.useCallback(w=>{w.button!==2&&w.target===u.current&&(v({start:{x:w.clientX,y:w.clientY},current:{x:w.clientX,y:w.clientY}}),w.ctrlKey||d([]))},[u]);s.useEffect(()=>{if(!c)return;const w=r=>v(l=>l?{...l,current:{x:r.clientX,y:r.clientY}}:null),y=()=>v(null);return window.addEventListener("mousemove",w),window.addEventListener("mouseup",y),()=>{window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",y)}},[c]),s.useEffect(()=>{if(!c)return;const w=Math.min(c.start.x,c.current.x),y=Math.min(c.start.y,c.current.y),r=Math.max(c.start.x,c.current.x),l=Math.max(c.start.y,c.current.y),_=[];t.forEach(i=>{const a=o[i.id];if(!a)return;const h=M.OFFSET_X+a.col*M.W,b=M.OFFSET_Y+a.row*M.H;w<h+M.W&&r>h&&y<b+M.H&&l>b&&_.push(i.id)});const n=setTimeout(()=>d(_),0);return()=>clearTimeout(n)},[c,o,t]);const f=s.useCallback(w=>{const y=m[0];if(!y&&t.length>0){d([t[0].id]);return}const r=o[y];if(!r)return;let l=null,_=1/0;Object.entries(o).forEach(([n,i])=>{if(n===y)return;let a=!1,h=1/0;switch(w){case"ArrowRight":i.row===r.row&&i.col>r.col&&(a=!0,h=i.col-r.col);break;case"ArrowLeft":i.row===r.row&&i.col<r.col&&(a=!0,h=r.col-i.col);break;case"ArrowDown":i.col===r.col&&i.row>r.row&&(a=!0,h=i.row-r.row);break;case"ArrowUp":i.col===r.col&&i.row<r.row&&(a=!0,h=r.row-i.row);break}a&&h<_&&(_=h,l=n)}),l&&d([l])},[m,o,t]),p=s.useCallback(w=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(w.key)&&(w.preventDefault(),f(w.key))},[f]);return{selectedIconIds:m,setSelectedIconIds:d,selectionBox:c,handleMouseDown:g,handleKeyDown:p}},De=t=>{const{onCloseWindow:o,onToggleStartMenu:u,onEscape:m}=t;s.useEffect(()=>{const d=c=>{if(c.altKey&&c.key==="F4"){c.preventDefault(),o?.();return}if((c.metaKey||c.key==="Meta"||c.key==="OS")&&!c.ctrlKey&&!c.altKey){c.preventDefault(),u?.();return}if(c.key==="Escape"){m?.();return}};return window.addEventListener("keydown",d),()=>{window.removeEventListener("keydown",d)}},[o,u,m])},Ce=()=>{const{windows:t,openWindow:o,getAppById:u}=F(),m=s.useRef(t);s.useEffect(()=>{m.current=t},[t]),s.useEffect(()=>{const v=setInterval(()=>{if(!m.current.some(f=>f.id===Y.ASSISTANT)){const f=u(Y.ASSISTANT);f&&o(f,{isAutoOpened:!0})}},6e4);return()=>clearInterval(v)},[o,u])},H={W:100,H:128,OFFSET_X:10,OFFSET_Y:10},Ve=({apps:t=[]})=>{const{t:o}=L(),{windows:u,openWindow:m,isCrashed:d,isShutDown:c,rebootSystem:v}=F(),g=s.useRef(null),f=s.useRef({});Ce();const p=s.useRef({id:"",time:0}),{displayItems:w,computedPositions:y,handleDragEnd:r,dragVersion:l,arrangeIcons:_}=Me(t),{selectedIconIds:n,setSelectedIconIds:i,selectionBox:a}=Ne(w,y,g),[h,b]=s.useState(null),{containerRef:j,handleKeyDown:S}=V(!!h);s.useEffect(()=>{if(n.length===1){const A=n[0],E=f.current[A];E&&E.focus()}},[n]);const{activeWindowId:D,closeWindow:C}=F();De({onCloseWindow:()=>{D&&C(D)},onEscape:()=>{b(null),i([]),g.current?.focus()}});const N=s.useRef(!1);s.useEffect(()=>{if(N.current)return;if(N.current=!0,!localStorage.getItem("portfolio_visited")){localStorage.setItem("portfolio_visited","true");const E=t.find(W=>W.id===Y.WELCOME);E&&setTimeout(()=>m(E),500)}},[t,m]);const x=s.useCallback(A=>{const E=w.find(I=>I.id===A);if(!E)return;if(E.isSystemApp){const I=t.find(T=>T.id===E.appId);I&&m(I);return}if(E.type==="folder"){const I=t.find(T=>T.id==="computer")||t.find(T=>T.id==="documents");I&&m(I,{folderId:E.fsId});return}const W=t.find(I=>I.id===E.appId);W&&m(W,{content:E.content,title:E.title})},[w,t,m]);return d?e.jsx(Se,{onReboot:v}):c?e.jsx(ae,{onReboot:v}):e.jsxs("main",{className:"desktop",children:[e.jsx("a",{href:"#desktop-icons",className:"desktop__skip-link",children:o("skip_to_content")}),e.jsx("div",{id:"desktop-nav-hint",className:"sr-only",style:{position:"absolute",width:"1px",height:"1px",overflow:"hidden",clip:"rect(0,0,0,0)"},children:o("desktop_nav_hint")}),e.jsxs("div",{ref:g,id:"desktop-icons",className:"desktop__inner",children:[e.jsx("div",{className:"desktop__icons-layer",children:w.map(A=>{const E=y[A.id];if(!E)return null;const W={id:A.id,title:A.title,icon:A.icon,component:()=>null},I=n.includes(A.id),T=n.length>0?I&&n[0]===A.id:!1,k=w[0]?.id===A.id,z=T||n.length===0&&k?0:-1;return e.jsx(J,{ref:B=>{f.current[A.id]=B},app:W,isSelected:I,tabIndex:z,"aria-describedby":"desktop-nav-hint",initialPosition:{x:H.OFFSET_X+E.col*H.W,y:H.OFFSET_Y+E.row*H.H},onDragEnd:r,resetKey:l,onSelect:(B,Q)=>{const P=Date.now();p.current.id===B&&P-p.current.time<500?(x(B),p.current={id:"",time:0}):p.current={id:B,time:P},i(Z=>Q?Array.from(new Set([...Z,B])):[B])}},A.id)})}),a&&e.jsx("div",{className:"desktop__selection-box",style:{left:Math.min(a.start.x,a.current.x),top:Math.min(a.start.y,a.current.y),width:Math.abs(a.current.x-a.start.x),height:Math.abs(a.current.y-a.start.y)}}),h&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"desktop__context-menu-overlay",onClick:()=>b(null),onContextMenu:A=>A.preventDefault(),"aria-label":o("close_button"),type:"button"}),e.jsxs("div",{ref:j,className:"desktop__context-menu",style:{left:h.x,top:h.y},role:"menu","aria-label":o("desktop_context_menu"),onKeyDown:A=>{S(A),A.key==="Escape"&&b(null)},children:[e.jsx("button",{className:"desktop__context-menu-item",role:"menuitem",tabIndex:0,onClick:()=>{_(),b(null)},children:o("arrange_icons")}),e.jsx("div",{className:"desktop__context-menu-separator"})]})]}),u.map(A=>e.jsx(je,{data:A},A.id)),e.jsx("div",{className:"desktop__taskbar-layer",children:e.jsx(ge,{availableApps:t})})]})]})};export{Ve as Desktop};
