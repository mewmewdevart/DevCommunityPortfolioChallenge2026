import{r as o,j as e,R as q}from"./vendor-CGXhCyq3.js";import{u as F,L as P,a as ee,f as te,i as ne,A as Y}from"./index-BiW8pBaH.js";import{u as L,c as X,I as z,i as se,d as oe,e as ie}from"./game-BD-K9wUi.js";import{W as O}from"./WinButton--HS0O22h.js";import{C as U}from"./close-BryC9SWZ.js";import{M as re}from"./minus-1uO7_Sla.js";import{ShutdownScreen as ae}from"./ShutdownScreen-TIoYLcxu.js";import{i as ce}from"./file-alt-2Rtj3xTs.js";import"./i18n-CjG_VPcn.js";const le=()=>{const{t}=L(),[s,d]=o.useState(new Date);return o.useEffect(()=>{const u=setInterval(()=>d(new Date),1e3);return()=>clearInterval(u)},[]),e.jsx("div",{className:"clock","aria-label":t("system_clock"),role:"timer",children:s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})},de=()=>{const{volume:t,setVolume:s}=X(),{t:d}=L(),[u,l]=o.useState(!1),a=o.useRef(null),w=o.useRef(null),g=()=>l(!u);return o.useEffect(()=>{const p=v=>{a.current&&!a.current.contains(v.target)&&w.current&&!w.current.contains(v.target)&&l(!1)};return u&&document.addEventListener("mousedown",p),()=>{document.removeEventListener("mousedown",p)}},[u]),e.jsxs("div",{className:"volume-control",children:[u&&e.jsx("div",{className:"volume-control__popup",ref:a,children:e.jsx("div",{className:"volume-control__slider-wrapper",children:e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:t,onChange:p=>s(parseFloat(p.target.value)),className:"volume-control__slider",orient:"vertical","aria-label":d("volume_control")})})}),e.jsx("button",{ref:w,onClick:g,className:"volume-control__btn",title:d("volume"),"aria-label":d("volume"),"aria-haspopup":"true","aria-expanded":u,children:e.jsx(z,{icon:t>0?se:oe,size:18,className:"volume-control__icon"})})]})},ue="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAAyCAYAAAD4FkP1AAAAAXNSR0IArs4c6QAAAMdJREFUaIHt2rENgkAYhmExdlg7gXEGezegtbNxBAob1qC2snEgY4x2LkCtA/AX5ADx+/I+5YUcvPmTyxVk+6L6zEzNp/6AMRGnyjpuES0eVu/kDc/LXafnimOT/I7IpXy21qwnR5wq4lQRp4o4VeENpest499ZT444VdZx4YGSb9bJGza3e5/vGZT15IhTZR0XHii/cK3z0d9hPTniVFnHTXagnLavQferHu0168kRp4o4VcSpIk5Vxn8ooohTRZwq4lQRp+oLpYMS+7GH5SUAAAAASUVORK5CYII=",me="data:image/webp;base64,UklGRnIBAABXRUJQVlA4IGYBAADQCgCdASo3ADIAPmUqkEWkIqGb+1QAQAZEswBlGeFlV+Nwn59qdvtjedz/rv6k6zH6Ev7AdcJkSOO8KsfElJUhbP/yQdWz/e7HXClk8FB3Uqiu4dPO6zrd2gLymJiyAAD++faXh/4qfB7Z69thAb+V/ZZbADIBAAcmRT/SK4zOp+F8vH+WqJtBLfQx2bbAVLY+O2YSoEryUdaYAEyY0L6nHd7+Ga73IDS1Ba186QUZyiyEg/LvoAcZDbQsJZnS+3/Vssb77D0ompW4Sctx8n5PcVsVwyw3swZfmOyoDoWO+AWC2xNVNQpofllN2fpgYXlj+Xo3lhyx7uE/Z5yh9GnLXaJNL+UMxhe9CyA+gpoAnzT2r1jzGOCwiG+cL3+FnRRgnSczOZago3bJBwjfAiccHeYNI7bH+WdoxkpqGmClonsGkFhgmkAcFa1Xn0g60gGyJhcMYR4Eg2mxfoGfW+piQAAAAAAA",we="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3cpath%20d='M5%203h16v4h-2V5H5v14h14v-2h2v4H3V3h2zm16%208h-2V9h-2V7h-2v2h2v2H7v2h10v2h-2v2h2v-2h2v-2h2v-2z'%20fill='currentColor'/%3e%3c/svg%3e",he="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3cpath%20d='M8%205v2h2V5H8zm4%204V7h-2v2h2zm2%202V9h-2v2h2zm0%202h2v-2h-2v2zm-2%202v-2h2v2h-2zm0%200h-2v2h2v-2zm-4%204v-2h2v2H8z'%20fill='currentColor'/%3e%3c/svg%3e",fe="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3cpath%20d='M4%204h8v2h10v14H2V4h2zm16%204H10V6H4v12h16V8z'%20fill='currentColor'/%3e%3c/svg%3e",V=t=>{const s=o.useRef(null),d=o.useRef(null);return o.useEffect(()=>{if(t){d.current=document.activeElement;const l=s.current?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');l&&l.length>0&&requestAnimationFrame(()=>{l[0].focus()})}return()=>{t&&d.current&&d.current.isConnected&&d.current.focus()}},[t]),{containerRef:s,handleKeyDown:l=>{if(!(!t||!s.current)&&l.key==="Tab"){const a=s.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!a.length)return;const w=a[0],g=a[a.length-1];l.shiftKey?document.activeElement===w&&(l.preventDefault(),g.focus()):document.activeElement===g&&(l.preventDefault(),w.focus())}}}},pe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAAAXNSR0IArs4c6QAAAUJJREFUeJzt3LFJBFEUQFFXzIw0swQjwQ7EQLADCxDjrWQLsIDNDAVFsAZzI2PBErSA+cGwV9SVc8LHwHwuDz4bzC4O948+d9jY7m8fYNsJGAkYCRjtjYZXq/ufP8kWWC8vJzMbGAkYCRgJGA0vkZHV9cGs55a3H+U83+ri7GUyO355n8zenl4ns7vTm1nvsIGRgJGAkYDR7EvkL10Ocz08n0xnowdPzzd+hw2MBIwEjASMhpfI3F8d/9nj89tkth48ZwMjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwEjASMBIwGj4Rfro6+1GbOBkYCRgJGA0cJfwTc2MBIwEjASMPoCIOsbRX7fweMAAAAASUVORK5CYII=",ve="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3cpath%20d='M20%203H2v14h8v2H8v2h8v-2h-2v-2h8V3h-2zm-6%2012H4V5h16v10h-6z'%20fill='currentColor'/%3e%3c/svg%3e",xe=({onCancel:t})=>{const{t:s}=L(),{shutDownSystem:d,rebootSystem:u,returnToGame:l}=F(),[a,w]=o.useState("shutdown"),{containerRef:g,handleKeyDown:p}=V(!0);o.useEffect(()=>{const h=y=>{y.key==="Escape"&&t()};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[t]);const v=()=>{switch(a){case"shutdown":d();break;case"restart":u();break;case"return_game":l();break}};return e.jsx("div",{className:"shutdown-dialog-overlay",role:"dialog","aria-modal":"true","aria-labelledby":"shutdown-title",children:e.jsxs("div",{className:"shutdown-dialog",ref:g,onKeyDown:p,children:[e.jsxs("div",{className:"shutdown-dialog__header",children:[e.jsx("span",{id:"shutdown-title",className:"shutdown-dialog__title",children:s("shutdown_title")}),e.jsx("button",{className:"shutdown-dialog__close",onClick:t,"aria-label":s("close"),children:"Ã—"})]}),e.jsxs("div",{className:"shutdown-dialog__content",children:[e.jsx("div",{className:"shutdown-dialog__icon",children:e.jsx(z,{icon:ve,size:32})}),e.jsxs("div",{className:"shutdown-dialog__options",children:[e.jsx("h3",{className:"shutdown-dialog__label",children:s("shutdown_question")}),e.jsxs("div",{className:"shutdown-dialog__radio-group",role:"radiogroup",children:[e.jsxs("label",{className:"shutdown-dialog__radio-option",children:[e.jsx("input",{type:"radio",name:"shutdown-option",value:"shutdown",checked:a==="shutdown",onChange:()=>w("shutdown"),className:"shutdown-dialog__radio-input"}),s("shutdown_computer")]}),e.jsxs("label",{className:"shutdown-dialog__radio-option",children:[e.jsx("input",{type:"radio",name:"shutdown-option",value:"restart",checked:a==="restart",onChange:()=>w("restart"),className:"shutdown-dialog__radio-input"}),s("restart_computer")]}),e.jsxs("label",{className:"shutdown-dialog__radio-option",children:[e.jsx("input",{type:"radio",name:"shutdown-option",value:"return_game",checked:a==="return_game",onChange:()=>w("return_game"),className:"shutdown-dialog__radio-input"}),s("return_to_game")]})]})]})]}),e.jsxs("div",{className:"shutdown-dialog__buttons",children:[e.jsx("button",{className:"shutdown-dialog__button",onClick:v,children:s("ok")}),e.jsx("button",{className:"shutdown-dialog__button",onClick:t,children:s("cancel")})]})]})})},_e=({onClose:t,apps:s})=>{const{t:d}=L(),{openWindow:u}=F(),l=o.useRef(null),[a,w]=o.useState(null),[g,p]=o.useState(!1),v=o.useRef(null),{containerRef:h,handleKeyDown:y}=V(!g),r=n=>{if(y(n),n.key==="ArrowDown"||n.key==="ArrowUp"){n.preventDefault();const i=Array.from(l.current?.querySelectorAll('[role="menuitem"]')||[]);if(i.length===0)return;const c=i.indexOf(document.activeElement);let f=c;n.key==="ArrowDown"?f=(c+1)%i.length:f=(c-1+i.length)%i.length,i[f]?.focus()}n.key==="Escape"&&t()};o.useEffect(()=>{const n=i=>{if(!g&&h.current&&!h.current.contains(i.target)){if(document.getElementById("start-button")?.contains(i.target))return;t()}};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[t,h,g]);const m=n=>{u(n),t()},_=s.find(n=>n.id==="projects");return g?e.jsx(xe,{onCancel:()=>p(!1)}):e.jsxs("div",{ref:h,className:"start-menu",onKeyDown:r,onContextMenu:n=>{n.preventDefault(),n.stopPropagation()},role:"menu","aria-label":d("start_menu"),children:[e.jsx("aside",{className:"start-menu__sidebar","aria-hidden":"true",children:e.jsxs("span",{className:"start-menu__sidebar-text",children:[e.jsx("span",{className:"start-menu__brand-name",children:"Windows"}),"95"]})}),e.jsxs("section",{className:"start-menu__content",children:[e.jsxs("div",{className:"start-menu__item-wrapper",onMouseEnter:()=>w("programs"),onMouseLeave:()=>w(null),role:"none",children:[e.jsxs(O,{ref:v,variant:"menu",role:"menuitem","aria-haspopup":"true","aria-expanded":a==="programs",className:"start-menu__item",onClick:()=>w(a==="programs"?null:"programs"),onKeyDown:n=>{(n.key==="ArrowRight"||n.key==="Enter"||n.key===" ")&&(w("programs"),n.preventDefault(),setTimeout(()=>{document.getElementById("submenu-programs-0")?.focus()},0))},children:[e.jsx(z,{icon:pe,size:24,className:"start-menu__item-icon"}),e.jsx("span",{className:"start-menu__label",children:d("programs")}),e.jsx(z,{icon:he,className:"start-menu__chevron"})]}),a==="programs"&&e.jsx("div",{className:"start-menu__submenu",role:"menu",children:s.filter(n=>n.visibility?.programs).map((n,i)=>e.jsxs(O,{id:`submenu-programs-${i}`,variant:"menu",onClick:()=>m(n),role:"menuitem",className:"start-menu__item",onKeyDown:c=>{c.key==="ArrowLeft"&&(w(null),c.preventDefault(),c.stopPropagation(),v.current?.focus())},children:[e.jsx(z,{icon:n.icon,size:24,className:"start-menu__item-icon"}),e.jsx("span",{className:"start-menu__label",children:n.title})]},n.id))})]}),e.jsxs(O,{variant:"menu",onClick:()=>_&&m(_),role:"menuitem",className:"start-menu__item",children:[e.jsx(z,{icon:_?.icon||fe,size:24,className:"start-menu__item-icon"}),e.jsx("span",{className:"start-menu__label",children:d("projects")})]}),e.jsx("div",{className:"start-menu__divider"}),e.jsxs(O,{variant:"menu",onClick:()=>p(!0),role:"menuitem",className:"start-menu__item",children:[e.jsx(z,{icon:we,className:"start-menu__icon"}),e.jsx("span",{className:"start-menu__label",children:d("shutdown")})]})]})]})},ge=({availableApps:t})=>{const{t:s,language:d,setLanguage:u}=L(),{windows:l,activeWindowId:a,focusWindow:w,minimizeWindow:g}=F(),[p,v]=o.useState(!1),[,h]=o.useState(new Date),[y,r]=o.useState(null),m=o.useRef(null),_=o.useRef(null),n=16,i=6,c=1600,f=()=>{u(d==="en"?"pt-BR":d==="pt-BR"?"es":"en")},b=s(d==="en"?"btn_to_pt":d==="pt-BR"?"btn_to_es":"btn_to_en");o.useEffect(()=>{const x=E=>{(E.key==="Meta"||E.ctrlKey&&E.key==="Escape")&&(E.preventDefault(),window.dispatchEvent(new CustomEvent("toggle-start-menu")))};window.addEventListener("keydown",x);const k=setInterval(()=>h(new Date),1e3);return()=>{window.removeEventListener("keydown",x),clearInterval(k)}},[]),o.useEffect(()=>{const x=k=>{_.current&&!_.current.contains(k.target)&&v(!1)};return p&&document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[p]),o.useEffect(()=>()=>{m.current&&clearTimeout(m.current)},[]);const j=x=>{const k=l.find(E=>E.id===x);v(!1),a===x&&!k?.isMinimized?g(x):w(x)},S=x=>x.length>n?x.substring(0,n)+"...":x,D=x=>{m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{r(x)},c)},C=()=>{m.current&&(clearTimeout(m.current),m.current=null),r(null)},N=l.slice(0,i);return e.jsxs("footer",{className:"taskbar",role:"contentinfo","aria-label":s("taskbar_label")||"Taskbar",onContextMenu:x=>{x.preventDefault(),x.stopPropagation()},children:[e.jsxs("div",{className:"taskbar__start-menu-wrapper",ref:_,children:[p&&e.jsx("div",{className:"taskbar__start-popup",children:e.jsx(_e,{onClose:()=>v(!1),apps:t})}),e.jsxs(O,{id:"start-button",active:p,onClick:()=>v(!p),className:"taskbar__start-btn",variant:"taskbar","aria-haspopup":"true","aria-expanded":p,"aria-label":s("start_menu"),children:[e.jsxs("picture",{children:[e.jsx("source",{srcSet:me,type:"image/webp"}),e.jsx("img",{src:ue,alt:s("alt_taskbar_start_icon"),className:"taskbar__icon",onError:x=>{x.currentTarget.style.display="none"},"aria-hidden":"true",width:16,height:16})]}),e.jsx("span",{className:"taskbar__start-text",children:s("start")})]})]}),e.jsx("div",{className:"taskbar__divider"}),e.jsx("nav",{className:"taskbar__windows","aria-label":s("running_apps")||"Running applications",children:N.map(x=>{const k=x.title.length>n,E=a===x.id&&!x.isMinimized;return e.jsxs("div",{className:"taskbar__window-item",onMouseEnter:()=>D(x.id),onMouseLeave:C,onClick:C,children:[y===x.id&&k&&e.jsx("div",{className:"taskbar__tooltip",role:"tooltip",children:x.title}),e.jsxs(O,{active:E,onClick:()=>j(x.id),className:"taskbar__window-btn",variant:"taskbar","aria-label":`Switch to ${x.title}`,"aria-pressed":E,children:[e.jsx(z,{icon:x.icon,size:16,className:"taskbar__window-icon",alt:s("alt_taskbar_app_icon")}),e.jsx("span",{className:"taskbar__window-text",children:S(x.title)})]})]},x.id)})}),e.jsx("div",{className:"taskbar__divider"}),e.jsxs("div",{className:"taskbar__tray",children:[e.jsx("button",{onClick:f,className:"taskbar__language-btn",title:b,"aria-label":b,children:d==="en"?"ðŸ‡ºðŸ‡¸":d==="pt-BR"?"ðŸ‡§ðŸ‡·":"ðŸ‡ªðŸ‡¸"}),e.jsx(de,{}),e.jsx(le,{})]})]})},$=(t,s,d=0,u)=>{const[l,a]=o.useState(!1),[w,g]=o.useState(t),p=o.useRef({offset:{x:0,y:0},position:t,boundary:u,resetKey:d});o.useEffect(()=>{p.current.boundary=u},[u]),o.useEffect(()=>{g(t),p.current.position=t},[d]);const v=o.useCallback((r,m)=>{const _=p.current.position;p.current.offset={x:r-_.x,y:m-_.y},a(!0)},[]),h=o.useCallback(r=>{r.button===0&&(r.stopPropagation(),v(r.clientX,r.clientY))},[v]),y=o.useCallback(r=>{r.stopPropagation();const m=r.touches[0];v(m.clientX,m.clientY)},[v]);return o.useEffect(()=>{if(!l)return;const r=(i,c)=>{const{offset:f,boundary:b}=p.current;let j=i-f.x,S=c-f.y;if(b){const C=window.innerWidth-b.width,N=window.innerHeight-b.height-(b.bottomOffset??0),x=20;j<x&&(j=0),Math.abs(j-C)<x&&(j=C),S<x&&(S=0),Math.abs(S-N)<x&&(S=N),j=Math.max(0,Math.min(j,C)),S=Math.max(0,Math.min(S,N))}const D={x:j,y:S};g(D),p.current.position=D},m=i=>{i.preventDefault(),r(i.clientX,i.clientY)},_=i=>{i.cancelable&&i.preventDefault(),r(i.touches[0].clientX,i.touches[0].clientY)},n=()=>{a(!1),s(p.current.position)};return window.addEventListener("mousemove",m),window.addEventListener("mouseup",n),window.addEventListener("touchmove",_,{passive:!1}),window.addEventListener("touchend",n),()=>{window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",n),window.removeEventListener("touchmove",_),window.removeEventListener("touchend",n)}},[l,s]),{position:w,handleMouseDown:h,handleTouchStart:y,isDragging:l}},be={width:300,height:200},ye=(t,s,d,u,l,a,w=be)=>{const[g,p]=o.useState(u),[v,h]=o.useState(!1),y=o.useRef(u),{width:r,height:m}=u;o.useEffect(()=>{v||p(n=>{if(n.width===r&&n.height===m)return n;const i={width:r,height:m};return y.current=i,i})},[r,m,v]);const _=o.useCallback(n=>{t&&(n.stopPropagation(),n.cancelable&&n.preventDefault(),h(!0))},[t]);return o.useEffect(()=>{if(!v||s)return;const n=(b,j)=>{const D=window.innerHeight-a,C=Math.min(j,D),N=b-d.x,x=C-d.y,k={width:Math.max(w.width,N),height:Math.max(w.height,x)};p(k),y.current=k},i=b=>{b.preventDefault(),n(b.clientX,b.clientY)},c=b=>{b.cancelable&&b.preventDefault(),n(b.touches[0].clientX,b.touches[0].clientY)},f=()=>{h(!1),l(y.current.width,y.current.height)};return window.addEventListener("mousemove",i),window.addEventListener("mouseup",f),window.addEventListener("touchmove",c,{passive:!1}),window.addEventListener("touchend",f),()=>{window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",f),window.removeEventListener("touchmove",c),window.removeEventListener("touchend",f)}},[v,s,d,a,l,w]),{size:g,isResizing:v,startResize:_}},ke=65,Ae=({data:t})=>{const{focusWindow:s,updateWindowPosition:d,activeWindowId:u,closeWindow:l}=F(),{t:a}=L(),w=o.useRef(null),g=u===t.id,p=`${t.id}-${t.isMaximized}-${t.size.width}-${t.size.height}`,{handleMouseDown:v,isDragging:h}=$(t.position,m=>d(t.id,m.x,m.y),p,{width:t.size.width,height:t.size.height,bottomOffset:ke}),y=()=>s(t.id),r={zIndex:t.zIndex,width:t.size.width,height:t.size.height,transform:`translate3d(${t.position.x}px, ${t.position.y}px, 0)`,position:"absolute",top:0,left:0,willChange:h?"transform":"auto"};return e.jsxs("div",{ref:w,style:r,onMouseDown:m=>{y(),v(m)},className:`window--assistant ${g?"window--active":""}`,role:"dialog","aria-modal":"false","aria-label":t.title,tabIndex:-1,children:[e.jsx("button",{className:"window__close-btn assistant-close-btn",onClick:m=>{m.stopPropagation(),l(t.id)},"aria-label":a("close_assistant"),children:e.jsx(z,{icon:U,size:14,style:{filter:"invert(1)"}})}),e.jsx(o.Suspense,{fallback:e.jsx(P,{}),children:t.component})]})},Ee="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%3e%3cpath%20d='M5%203h12v4h4v14H7v-4H3V3h2zm10%204V5H5v10h2V7h8zM9%2017v2h10V9H9v8z'%20fill='currentColor'/%3e%3c/svg%3e",K=65,je=({item:t,t:s,onAction:d,windowId:u,actions:l})=>{o.useEffect(()=>{const w=document.getElementById(`menu-${u}-${t}-0`);w&&w.focus()},[t,u]);const a=w=>{w.key==="Escape"&&d()};return e.jsxs(e.Fragment,{children:[t==="file"&&e.jsx("button",{id:`menu-${u}-${t}-0`,className:"window__menu-dropdown-item",role:"menuitem",onClick:w=>{w.stopPropagation(),l.close(),d()},onKeyDown:a,children:s("close")}),t==="view"&&e.jsx("button",{id:`menu-${u}-${t}-0`,className:"window__menu-dropdown-item",role:"menuitem",onClick:w=>{w.stopPropagation(),l.maximize(),d()},onKeyDown:a,children:l.isMaximized?s("restore"):s("maximize")}),t==="help"&&e.jsx("button",{id:`menu-${u}-${t}-0`,className:"window__menu-dropdown-item",role:"menuitem",onClick:w=>{w.stopPropagation(),alert(s("about_alert")),d()},onKeyDown:a,children:s("about")}),t==="edit"&&e.jsx("div",{className:"window__menu-dropdown-item disabled",style:{opacity:.5,cursor:"default"},children:s("no_actions")})]})},Se=({data:t})=>{const{t:s}=L(),{closeWindow:d,minimizeWindow:u,maximizeWindow:l,focusWindow:a,updateWindowPosition:w,updateWindowSize:g,activeWindowId:p}=F(),v=p===t.id,[h,y]=q.useState(null);o.useEffect(()=>{const A=()=>y(null);return h&&window.addEventListener("click",A),()=>window.removeEventListener("click",A)},[h]);const{containerRef:r,handleKeyDown:m}=V(v),_=t.id.startsWith("assistant"),n=`${t.id}-${t.isMaximized}-${t.size.width}-${t.size.height}`,{position:i,handleMouseDown:c,handleTouchStart:f,isDragging:b}=$(t.position,A=>w(t.id,A.x,A.y),n,{width:t.size.width,height:t.size.height,bottomOffset:K}),{size:j,isResizing:S,startResize:D}=ye(v,t.isMaximized,i,t.size,(A,R)=>g(t.id,A,R),K,{width:300,height:300});o.useEffect(()=>{v&&r.current&&r.current.focus({preventScroll:!0})},[v,r]);const C=A=>{v&&m(A)};if(t.isMinimized)return null;const N=()=>a(t.id),x=t.isMaximized?"100%":j.width,k=t.isMaximized?`calc(100vh - ${K}px)`:j.height,E={zIndex:t.zIndex,width:x,height:k,transform:t.isMaximized?"none":`translate3d(${i.x}px, ${i.y}px, 0)`,position:t.isMaximized?"fixed":"absolute",top:0,left:0,willChange:b||S?"transform, width, height":"auto"};if(_)return e.jsx(Ae,{data:t});const I=!["messenger","welcome","calculator","google"].some(A=>t.id.startsWith(A)),T=["file","edit","view","help"];return e.jsxs("div",{ref:r,style:E,onMouseDownCapture:N,onTouchStartCapture:N,onKeyDown:C,onContextMenu:A=>{A.preventDefault(),A.stopPropagation()},className:`window ${v?"window--active":"window--inactive"}`,role:"dialog","aria-labelledby":`window-title-${t.id}`,"aria-modal":v?"true":"false",tabIndex:-1,children:[e.jsxs("div",{className:`window__title-bar ${v?"window__title-bar--active":"window__title-bar--inactive"}`,onMouseDown:A=>!t.isMaximized&&c(A),onTouchStart:A=>!t.isMaximized&&f(A),onDoubleClick:()=>l(t.id),children:[e.jsxs("div",{className:"window__title-area",id:`window-title-${t.id}`,children:[e.jsx(z,{icon:t.icon,size:20}),e.jsx("span",{className:"window__title-text",children:t.title})]}),e.jsxs("div",{className:"window__actions",children:[e.jsx(O,{"aria-label":s("minimize"),onClick:()=>u(t.id),children:e.jsx("img",{src:re,className:"window__action-icon",alt:s("window_btn_minimize_alt")})}),e.jsx(O,{"aria-label":t.isMaximized?s("restore"):s("maximize"),onClick:()=>l(t.id),children:t.isMaximized?e.jsx("img",{src:Ee,className:"window__action-icon",alt:s("window_btn_restore_alt")}):e.jsx("img",{src:ie,className:"window__action-icon",alt:s("window_btn_maximize_alt")})}),e.jsx(O,{"aria-label":s("close"),onClick:()=>d(t.id),children:e.jsx("img",{src:U,className:"window__action-icon",alt:s("window_btn_close_alt")})})]})]}),I&&e.jsx("div",{className:"window__menu",role:"menubar",children:T.map(A=>e.jsxs("div",{style:{position:"relative"},role:"none",children:[e.jsx("button",{className:`window__menu-item not-allowed ${h===A?"window__menu-item--active":""}`,role:"menuitem","aria-haspopup":"true","aria-expanded":h===A,onClick:R=>{R.stopPropagation(),y(h===A?null:A)},onMouseEnter:()=>{h&&y(A)},onKeyDown:R=>{R.key==="ArrowDown"&&h===A&&(document.getElementById(`menu-${t.id}-${A}-0`)?.focus(),R.preventDefault()),R.key==="ArrowDown"&&!h&&(y(A),R.preventDefault())},children:s(A)}),h===A&&e.jsx("div",{className:"window__menu-dropdown",role:"menu",onMouseLeave:()=>y(null),children:e.jsx(je,{item:A,t:s,onAction:()=>y(null),windowId:t.id,actions:{close:()=>d(t.id),maximize:()=>l(t.id),isMaximized:t.isMaximized}})})]},A))}),e.jsxs("div",{className:"window__content",children:[e.jsx(o.Suspense,{fallback:e.jsx("div",{className:"window__loading",children:e.jsx(P,{})}),children:t.component}),!v&&e.jsx("div",{className:"window__overlay"})]}),!t.isMaximized&&e.jsx("div",{className:"window__resize-handle",onMouseDown:D,onTouchStart:D,"aria-hidden":"true",title:s("window_resize"),children:e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 12 12",className:"window__resize-icon",children:[e.jsx("path",{d:"M8 11H11V8",stroke:"gray",fill:"none"}),e.jsx("path",{d:"M4 11H7V11",stroke:"gray",fill:"none"}),e.jsx("path",{d:"M11 7V4",stroke:"gray",fill:"none"})]})})]})},J=o.forwardRef(({app:t,initialPosition:s,onDragEnd:d,onSelect:u,isSelected:l,resetKey:a,tabIndex:w=0},g)=>{const{t:p}=L(),v=o.useMemo(()=>({width:100,height:128,bottomOffset:50}),[]),{position:h,handleMouseDown:y,handleTouchStart:r,isDragging:m}=$(s,n=>d(t.id,n.x,n.y),a,v),_=n=>{n.stopPropagation();const i=n.ctrlKey||n.metaKey||n.shiftKey;u(t.id,i)};return e.jsxs("button",{ref:g,type:"button",className:`desktop-icon ${l?"desktop-icon--selected":""} ${m?"desktop-icon--dragging":""}`,style:{transform:`translate3d(${h.x}px, ${h.y}px, 0)`},onMouseDown:n=>{_(n),y(n)},onClick:_,onKeyDown:n=>{if(n.key==="Enter"){n.preventDefault(),n.stopPropagation(),u(t.id,!1);const i=new MouseEvent("dblclick",{bubbles:!0,cancelable:!0,view:window});n.currentTarget.dispatchEvent(i)}},onTouchStart:r,onContextMenu:n=>{n.preventDefault(),n.stopPropagation()},"aria-label":t.title,"aria-pressed":l,tabIndex:w,children:[e.jsx("div",{className:"desktop-icon__img-wrapper",children:e.jsx(z,{icon:t.icon,size:64,className:"desktop-icon__img",alt:p("alt_desktop_app_icon")})}),e.jsx("div",{className:"desktop-icon__label",children:e.jsx("span",{className:"desktop-icon__text",children:t.title})})]})});J.displayName="DesktopIcon";const Ie=({onReboot:t})=>{const s=o.useRef(null),{t:d}=L(),{playSound:u}=X();return o.useEffect(()=>{u("error"),s.current?.focus();const l=a=>{a?.preventDefault(),t()};return window.addEventListener("keydown",l),window.addEventListener("click",l),window.addEventListener("touchstart",l),window.addEventListener("pointerdown",l),()=>{window.removeEventListener("keydown",l),window.removeEventListener("click",l),window.removeEventListener("touchstart",l),window.removeEventListener("pointerdown",l)}},[t,u]),e.jsx("div",{ref:s,tabIndex:-1,className:"blue-screen",children:e.jsxs("div",{className:"blue-screen__content",children:[e.jsx("p",{className:"blue-screen__title",children:d("blue_screen_windows")}),e.jsx("p",{className:"blue-screen__message",children:d("blue_screen_fatal_exception")}),e.jsxs("ul",{className:"blue-screen__list",children:[e.jsx("li",{children:d("blue_screen_terminate")}),e.jsx("li",{children:d("blue_screen_ctrl_alt_del")})]}),e.jsx("p",{className:"blue-screen__prompt",children:d("blue_screen_press_any_key")})]})})},M={W:100,H:128,OFFSET_X:10,OFFSET_Y:10},Me=50,Ne=t=>{const{getItemsInFolder:s}=ee(),[d,u]=o.useState(0),[l,a]=o.useState(()=>{try{const r=localStorage.getItem("OS_ICON_POSITIONS");return r?JSON.parse(r):{}}catch{return{}}});o.useEffect(()=>{localStorage.setItem("OS_ICON_POSITIONS",JSON.stringify(l))},[l]);const w=o.useMemo(()=>{const m=s("desktop").filter(n=>n.id!=="recycle_bin").map(n=>{let i=ce;if(n.type==="folder")i=te;else if(n.appId){const c=t.find(f=>f.id===n.appId);c&&(i=c.icon)}else i=ne;return{id:`fs:${n.id}`,title:n.name,icon:i,appId:n.appId||"notepad",fsId:n.id,type:n.type,isSystemApp:!1,content:n.content}});return[...t.filter(n=>n.visibility?.desktop).map(n=>({id:`app:${n.id}`,title:n.title,icon:n.icon,appId:n.id,type:"app",isSystemApp:!0})),...m].sort((n,i)=>n.title.localeCompare(i.title))},[s,t]),g=o.useMemo(()=>{if(typeof window>"u")return{maxRows:6,maxCols:10};const r=window.innerHeight,m=window.innerWidth,_=r-Me-M.OFFSET_Y,n=m-M.OFFSET_X,i=Math.max(1,Math.floor(_/M.H)),c=Math.max(1,Math.floor(n/M.W));return{maxRows:i,maxCols:c}},[d]),p=o.useCallback((r,m,_,n)=>Object.entries(_).some(([i,c])=>i===n?!1:c.col===r&&c.row===m),[]),v=o.useMemo(()=>{const r={...l},{maxRows:m,maxCols:_}=g,n=_<=4,i=()=>{let c=0,f=0,b=0;const j=m*_+500;if(n)for(;p(c,f,r)&&b<j;)c++,c>=_&&(c=0,f++),b++;else for(;p(c,f,r)&&b<j;)f++,f>=m&&(f=0,c++),b++;return{col:c,row:f}};return w.forEach(c=>{const f=r[c.id];if(!(f&&(n?!0:f.row<m)&&f.col<_)){const j=i();r[c.id]=j}}),r},[w,l,p,g]),h=o.useCallback((r,m,_)=>{const{maxRows:n,maxCols:i}=g,c=Math.round((m-M.OFFSET_X)/M.W),f=Math.round((_-M.OFFSET_Y)/M.H);u(b=>b+1),!(f<0||f>=n||c<0||c>=i)&&(p(c,f,v,r)||a(b=>({...b,[r]:{col:c,row:f}})))},[v,p,g]),y=o.useCallback(()=>{const{maxRows:r}=g,m={};let _=0,n=0;[...w].sort((c,f)=>c.title.localeCompare(f.title)).forEach(c=>{m[c.id]={col:_,row:n},n++,n>=r&&(n=0,_++)}),a(m),u(c=>c+1)},[w,g]);return o.useEffect(()=>{const r=()=>u(m=>m+1);return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),{displayItems:w,computedPositions:v,handleDragEnd:h,setIconPositions:a,setDragVersion:u,dragVersion:d,arrangeIcons:y}},De=(t,s,d)=>{const[u,l]=o.useState([]),[a,w]=o.useState(null),g=o.useCallback(h=>{h.button!==2&&h.target===d.current&&(w({start:{x:h.clientX,y:h.clientY},current:{x:h.clientX,y:h.clientY}}),h.ctrlKey||l([]))},[d]);o.useEffect(()=>{if(!a)return;const h=r=>w(m=>m?{...m,current:{x:r.clientX,y:r.clientY}}:null),y=()=>w(null);return window.addEventListener("mousemove",h),window.addEventListener("mouseup",y),()=>{window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",y)}},[a]),o.useEffect(()=>{if(!a)return;const h=Math.min(a.start.x,a.current.x),y=Math.min(a.start.y,a.current.y),r=Math.max(a.start.x,a.current.x),m=Math.max(a.start.y,a.current.y),_=[];t.forEach(i=>{const c=s[i.id];if(!c)return;const f=M.OFFSET_X+c.col*M.W,b=M.OFFSET_Y+c.row*M.H;h<f+M.W&&r>f&&y<b+M.H&&m>b&&_.push(i.id)});const n=setTimeout(()=>l(_),0);return()=>clearTimeout(n)},[a,s,t]);const p=o.useCallback(h=>{const y=u[0];if(!y&&t.length>0){l([t[0].id]);return}const r=s[y];if(!r)return;let m=null,_=1/0;Object.entries(s).forEach(([n,i])=>{if(n===y)return;let c=!1,f=1/0;switch(h){case"ArrowRight":i.row===r.row&&i.col>r.col&&(c=!0,f=i.col-r.col);break;case"ArrowLeft":i.row===r.row&&i.col<r.col&&(c=!0,f=r.col-i.col);break;case"ArrowDown":i.col===r.col&&i.row>r.row&&(c=!0,f=i.row-r.row);break;case"ArrowUp":i.col===r.col&&i.row<r.row&&(c=!0,f=r.row-i.row);break}c&&f<_&&(_=f,m=n)}),m&&l([m])},[u,s,t]),v=o.useCallback(h=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(h.key)&&(h.preventDefault(),p(h.key))},[p]);return{selectedIconIds:u,setSelectedIconIds:l,selectionBox:a,handleMouseDown:g,handleKeyDown:v}},Ce=t=>{const{onCloseWindow:s,onToggleStartMenu:d,onEscape:u}=t;o.useEffect(()=>{const l=a=>{if(a.altKey&&a.key==="F4"){a.preventDefault(),s?.();return}if((a.metaKey||a.key==="Meta"||a.key==="OS")&&!a.ctrlKey&&!a.altKey){a.preventDefault(),d?.();return}if(a.key==="Escape"){u?.();return}};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}},[s,d,u])},ze=()=>{const{windows:t,openWindow:s,getAppById:d}=F(),u=o.useRef(t);o.useEffect(()=>{u.current=t},[t]),o.useEffect(()=>{const w=setInterval(()=>{if(!u.current.some(p=>p.id===Y.ASSISTANT)){const p=d(Y.ASSISTANT);p&&s(p,{isAutoOpened:!0})}},6e4);return()=>clearInterval(w)},[s,d])},H={W:100,H:128,OFFSET_X:10,OFFSET_Y:10},Ke=({apps:t=[]})=>{const{t:s}=L(),{windows:d,openWindow:u,isCrashed:l,isShutDown:a,rebootSystem:w}=F(),g=o.useRef(null),p=o.useRef({});ze();const v=o.useRef({id:"",time:0}),{displayItems:h,computedPositions:y,handleDragEnd:r,dragVersion:m,arrangeIcons:_}=Ne(t),{selectedIconIds:n,setSelectedIconIds:i,selectionBox:c}=De(h,y,g),[f,b]=o.useState(null),{containerRef:j,handleKeyDown:S}=V(!!f);o.useEffect(()=>{if(n.length===1){const k=n[0],E=p.current[k];E&&E.focus()}},[n]);const{activeWindowId:D,closeWindow:C}=F();Ce({onCloseWindow:()=>{D&&C(D)},onEscape:()=>{b(null),i([]),g.current?.focus()}});const N=o.useRef(!1);o.useEffect(()=>{if(N.current)return;if(N.current=!0,!localStorage.getItem("portfolio_visited")){localStorage.setItem("portfolio_visited","true");const E=t.find(W=>W.id===Y.WELCOME);E&&setTimeout(()=>u(E),500)}},[t,u]);const x=o.useCallback(k=>{const E=h.find(I=>I.id===k);if(!E)return;if(E.isSystemApp){const I=t.find(T=>T.id===E.appId);I&&u(I);return}if(E.type==="folder"){const I=t.find(T=>T.id==="computer")||t.find(T=>T.id==="documents");I&&u(I,{folderId:E.fsId});return}const W=t.find(I=>I.id===E.appId);W&&u(W,{content:E.content,title:E.title})},[h,t,u]);return l?e.jsx(Ie,{onReboot:w}):a?e.jsx(ae,{onReboot:w}):e.jsxs("main",{className:"desktop",children:[e.jsx("a",{href:"#desktop-icons",className:"desktop__skip-link",children:s("skip_to_content")}),e.jsx("div",{id:"desktop-nav-hint",className:"sr-only",style:{position:"absolute",width:"1px",height:"1px",overflow:"hidden",clip:"rect(0,0,0,0)"},children:s("desktop_nav_hint")}),e.jsxs("div",{ref:g,id:"desktop-icons",className:"desktop__inner",children:[e.jsx("div",{className:"desktop__icons-layer",children:h.map(k=>{const E=y[k.id];if(!E)return null;const W={id:k.id,title:k.title,icon:k.icon,component:()=>null},I=n.includes(k.id),T=n.length>0?I&&n[0]===k.id:!1,A=h[0]?.id===k.id,R=T||n.length===0&&A?0:-1;return e.jsx(J,{ref:B=>{p.current[k.id]=B},app:W,isSelected:I,tabIndex:R,"aria-describedby":"desktop-nav-hint",initialPosition:{x:H.OFFSET_X+E.col*H.W,y:H.OFFSET_Y+E.row*H.H},onDragEnd:r,resetKey:m,onSelect:(B,Q)=>{const G=Date.now();v.current.id===B&&G-v.current.time<500?(x(B),v.current={id:"",time:0}):v.current={id:B,time:G},i(Z=>Q?Array.from(new Set([...Z,B])):[B])}},k.id)})}),c&&e.jsx("div",{className:"desktop__selection-box",style:{left:Math.min(c.start.x,c.current.x),top:Math.min(c.start.y,c.current.y),width:Math.abs(c.current.x-c.start.x),height:Math.abs(c.current.y-c.start.y)}}),f&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"desktop__context-menu-overlay",onClick:()=>b(null),onContextMenu:k=>k.preventDefault(),"aria-label":s("close_button"),type:"button"}),e.jsxs("div",{ref:j,className:"desktop__context-menu",style:{left:f.x,top:f.y},role:"menu","aria-label":s("desktop_context_menu"),onKeyDown:k=>{S(k),k.key==="Escape"&&b(null)},children:[e.jsx("button",{className:"desktop__context-menu-item",role:"menuitem",tabIndex:0,onClick:()=>{_(),b(null)},children:s("arrange_icons")}),e.jsx("div",{className:"desktop__context-menu-separator"})]})]}),d.map(k=>e.jsx(Se,{data:k},k.id)),e.jsx("div",{className:"desktop__taskbar-layer",children:e.jsx(ge,{availableApps:t})})]})]})};export{Ke as Desktop};
